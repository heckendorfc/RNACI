### Extension Flags
EXT_LDFLAGS = @EXT_LDFLAGS@
EXT_LIBS = @EXT_LIBS@
EXT_OBJS = @EXT_OBJS@

### R Default Makeconf
MkInclude = ${R_HOME}/etc${R_ARCH}/Makeconf

### R Package Flags
PKG_CFLAGS = -w
PKG_LIBS = $(EXT_LDFLAGS)

### Objective Files
R_OBJS = \
	SEXPtools/alloc.o \
	SEXPtools/floats.o \
	SEXPtools/misc.o \
	SEXPtools/printing.o \
	SEXPtools/structures_dataframes.o \
	SEXPtools/structures_lists.o \
	SEXPtools/structures_misc.o \
	tests/tests.o \
	package_examples.o

### Library
R_SEXPTOOLS = libsexptools.a
OBJECTS = ${R_OBJS}
BUILD_LIBS = $(SHLIB) $(EXT_LIBS)

USER_CONF = Makeconf

### Make Start
all: Makeconf $(BUILD_LIBS)

Makeconf:
	echo "R_SEXPTOOLS = lib${R_ARCH}/$(R_SEXPTOOLS)" > $(USER_CONF)

$(SHLIB): $(OBJECTS)

userLibrary: $(R_SEXPTOOLS)

SLmake:
	@rm -rf SLmake.inc
	echo "R_SEXPTOOLS = $(R_SEXPTOOLS)" > SLmake.inc
	echo "include $(MkInclude)" >> SLmake.inc
	@echo "" >> SLmake.inc
	@cat SLmake.inc.org >> SLmake.inc

$(R_SEXPTOOLS): SLmake
	( cd SEXPtools; $(MAKE) )

clean:
	@rm -rf *.o *.d *.rc *.so* *.dylib *.dll *.a *.lib \
	        Makedeps Makevars $(SHLIB) $(OBJECTS) $(USER_CONF)
