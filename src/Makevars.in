##########################################################

EXT_LDFLAGS = @EXT_LDFLAGS@
EXT_LIBS = @EXT_LIBS@
EXT_OBJS = @EXT_OBJS@

### R Default Makeconf
MkInclude = ${R_HOME}/etc${R_ARCH}/Makeconf


PKG_CFLAGS = -w
PKG_LIBS = $(EXT_LDFLAGS) $(FLIBS)

R_OBJS = \
	SEXPtools/alloc.o \
    SEXPtools/c11.o \
	SEXPtools/misc.o \
	SEXPtools/printing.o \
	SEXPtools/structures_dataframes.o \
	SEXPtools/structures_lists.o \
	SEXPtools/structures_misc.o \
	tests/tests.o \
	package_examples.o
R_SEXPTOOLS = libsexptools.a
OBJECTS = ${R_OBJS}
BUILD_LIBS = $(SHLIB) $(EXT_LIBS)

USER_CONF = Makeconf


all: $(BUILD_LIBS)
        @echo "CDEFS = $(CDEFS)" >> $(USER_CONF)
        @echo "CDEFS_CHECK = $(CDEFS_CHECK)" >> $(USER_CONF)
        @echo "PKG_CPPFLAGS = $(PKG_CPPFLAGS)" >> $(USER_CONF)
        @echo "PKG_CFLAGS = $(PKG_CFLAGSAGS)" >> $(USER_CONF)
        @echo "PKG_FFLAGS = $(PKG_FFLAGS)" >> $(USER_CONFF)
        @echo "PKG_LIBS = $(PKG_LIBS)" >> $(USER_CONF)
        @echo "R_SEXPTOOLS = lib${R_ARCH}/$(R_SEXPTOOLS)" >> $(USER_CONF)

$(SHLIB): $(OBJECTS)

userLibrary: $(R_SEXPTOOLS)

SLmake:
		@rm -rf SLmake.inc
		@echo "CDEFS = $(CDEFS)" >> SLmake.inc
		@echo "PKG_CPPFLAGS = $(PKG_CPPFLAGS)" >> SLmake.inc
		@echo "PKG_CFLAGS = $(PKG_CFLAGS)" >> SLmake.inc
		@echo "PKG_FFLAGS = $(PKG_FFLAGS)" >> SLmake.inc
		@echo "R_SEXPTOOLS = $(R_SEXPTOOLS)" >> SLmake.inc
		@echo "include $(MkInclude)" >> SLmake.inc
		@echo "" >> SLmake.inc
		@cat SLmake.inc.org >> SLmake.inc



$(R_SEXPTOOLS): SLmake
		( cd SEXPtools; $(MAKE) )



clean:
		@rm -rf *.o *.d *.rc *.so* *.dylib *.dll *.a *.lib \
				Makedeps Makevars $(SHLIB) $(OBJECTS)

